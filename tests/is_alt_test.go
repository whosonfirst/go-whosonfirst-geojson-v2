package tests

/*

because this:

> go test ./...
# github.com/whosonfirst/go-whosonfirst-geojson-v2/properties/whosonfirst
import cycle not allowed in test
package github.com/whosonfirst/go-whosonfirst-geojson-v2/properties/whosonfirst (test)
	imports github.com/whosonfirst/go-whosonfirst-geojson-v2/feature
	imports github.com/whosonfirst/go-whosonfirst-geojson-v2/properties/whosonfirst
FAIL	github.com/whosonfirst/go-whosonfirst-geojson-v2/properties/whosonfirst [setup failed]

so for now we'll just put tests here... (20190821/thisisaaronland)

*/

import (
	"errors"
	"testing"
	"github.com/whosonfirst/go-whosonfirst-geojson-v2/feature"
	"github.com/whosonfirst/go-whosonfirst-geojson-v2/properties/whosonfirst"	
	"strings"
)

func TestIsAlt(t *testing.T) {

	str_primary := `{
  "id": 85885597,
  "type": "Feature",
  "properties": {
    "edtf:cessation":"uuuu",
    "edtf:inception":"uuuu",
    "geom:area":0.000343,
    "geom:area_square_m":3317207.522282,
    "geom:bbox":"-121.373777,38.613784,-121.336778,38.639569",
    "geom:latitude":38.625901,
    "geom:longitude":-121.355795,
    "gn:id":"",
    "iso:country":"US",
    "lbl:latitude":38.624747,
    "lbl:longitude":-121.348077,
    "mps:latitude":38.627927,
    "mps:longitude":-121.35733,
    "mz:hierarchy_label":1,
    "mz:is_current":-1,
    "mz:is_funky":0,
    "mz:is_hard_boundary":0,
    "mz:is_landuse_aoi":0,
    "mz:is_official":0,
    "mz:max_zoom":18.0,
    "mz:min_zoom":15.0,
    "mz:tier_locality":0,
    "name:cat_x_preferred":[
        "Mission"
    ],
    "name:ceb_x_preferred":[
        "Mission"
    ],
    "name:dan_x_preferred":[
        "Mission"
    ],
    "name:deu_x_preferred":[
        "Mission"
    ],
    "name:eng_x_preferred":[
        "Mission"
    ],
    "name:est_x_preferred":[
        "Missioon"
    ],
    "name:fra_x_preferred":[
        "Mission"
    ],
    "name:ita_x_preferred":[
        "Mission"
    ],
    "name:jpn_x_preferred":[
        "\u30df\u30c3\u30b7\u30e7\u30f3"
    ],
    "name:kaz_x_preferred":[
        "\u041c\u0438\u0441\u0441\u0438\u044f"
    ],
    "name:nld_x_preferred":[
        "Mission"
    ],
    "name:pol_x_preferred":[
        "Mission"
    ],
    "name:por_x_preferred":[
        "Mission"
    ],
    "name:ron_x_preferred":[
        "Misiune"
    ],
    "name:rus_x_preferred":[
        "\u041c\u0438\u0441\u0441\u0438\u044f"
    ],
    "name:srp_x_preferred":[
        "\u041c\u0438\u0448\u043e\u043d"
    ],
    "name:swe_x_preferred":[
        "Mission"
    ],
    "name:ukr_x_preferred":[
        "\u041c\u0456\u0441\u0456\u044f"
    ],
    "name:unk_x_variant":[
        "Mission"
    ],
    "name:urd_x_preferred":[
        "\u0645\u0634\u0646"
    ],
    "name:vol_x_preferred":[
        "Mission"
    ],
    "qs:gn_adm0_cc":"US",
    "qs:gn_id":0,
    "qs:gn_local":5389489,
    "qs:gn_nam_loc":"Sacramento, Sacramento, California, US",
    "qs:gn_namadm1":"CA",
    "qs:local_max":27252,
    "qs:local_sum":92418,
    "qs:localhoods":62,
    "qs:name":"Mission",
    "qs:name_adm0":"United States",
    "qs:name_adm1":"California",
    "qs:name_adm2":"Sacramento",
    "qs:name_local":"Sacramento",
    "qs:photo_max":35,
    "qs:photo_sum":108,
    "qs:placetype":"Suburb",
    "qs:quad_count":11,
    "qs:woe_adm0":23424977,
    "qs:woe_adm1":2347563,
    "qs:woe_adm2":12587703,
    "qs:woe_lau":0,
    "qs:woe_local":2486340,
    "qs:woe_ver":"7.10.0",
    "src:geom":"zetashapes",
    "src:geom_alt":[
        "quattroshapes",
        "quattroshapes_pg"
    ],
    "src:lbl:centroid":"yerbashapes",
    "src:population":"zetashapes",
    "wof:belongsto":[
        85688637,
        102191575,
        85633793,
        85926841,
        102082889
    ],
    "wof:breaches":[],
    "wof:concordances":{
        "gp:id":55969094,
        "qs:id":383714,
        "qs_pg:id":383714
    },
    "wof:country":"US",
    "wof:geomhash":"8b535cd701cff9faa3967542b8929761",
    "wof:hierarchy":[
        {
            "continent_id":102191575,
            "country_id":85633793,
            "county_id":102082889,
            "locality_id":85926841,
            "neighbourhood_id":85885597,
            "region_id":85688637
        }
    ],
    "wof:id":85885597,
    "wof:lang":[
        "eng"
    ],
    "wof:lastmodified":1564123458,
    "wof:name":"Mission",
    "wof:parent_id":85926841,
    "wof:placetype":"neighbourhood",
    "wof:population":6608,
    "wof:population_rank":5,
    "wof:repo":"whosonfirst-data-admin-us",
    "wof:superseded_by":[],
    "wof:supersedes":[],
    "wof:tags":[],
    "zs:blockids":[
        60670076023007,
        60670059044016,
        60670059044004,
        60670059044010,
        60670059042003,
        60670059011013,
        60670059013023,
        60670060021003,
        60670059013015,
        60670059012018,
        60670059044015,
        60670059013030,
        60670059043007,
        60670059044018,
        60670059044000,
        60670059044009,
        60670059012016,
        60670059013039,
        60670059044013,
        60670059044020,
        60670059013020,
        60670059013024,
        60670059043001,
        60670059013022,
        60670059013040,
        60670059013013,
        60670077012002,
        60670059013011,
        60670059013018,
        60670060043003,
        60670060043005,
        60670059013025,
        60670059043004,
        60670059043009,
        60670059042000,
        60670059042001,
        60670076023008,
        60670059013012,
        60670059043008,
        60670059013037,
        60670059012017,
        60670060043000,
        60670059043003,
        60670059043002,
        60670059042002,
        60670059011020,
        60670059044012,
        60670060021001,
        60670059013035,
        60670059013038,
        60670059013021,
        60670059013019,
        60670059013014,
        60670059043005,
        60670059044007,
        60670059044014,
        60670059044011,
        60670059044001,
        60670077012004,
        60670060021002,
        60670059013010,
        60670059044008,
        60670060043006,
        60670059043006,
        60670059031003,
        60670059044002,
        60670059043000,
        60670059013031,
        60670059044003,
        60670060043004,
        60670059044006,
        60670059044005,
        60670059044017
    ],
    "zs:housing10":2962,
    "zs:pop10":6608
},
  "bbox": [
    -121.373777,
    38.613784,
    -121.336778,
    38.639569
],
  "geometry": {"coordinates":[[[-121.36913699999999,38.618998],[-121.364491,38.618957],[-121.364501,38.617578],[-121.36631199999999,38.617599],[-121.367406,38.617611],[-121.36849100000001,38.617624],[-121.369147,38.617631],[-121.369495,38.617635],[-121.370542,38.617647],[-121.371602,38.61766],[-121.37272900000001,38.617673],[-121.373777,38.617685],[-121.37375900000001,38.619902],[-121.37374699999999,38.621333],[-121.37185700000001,38.62131],[-121.370896,38.621299],[-121.37087200000001,38.622096],[-121.37088799999999,38.622181],[-121.37092699999999,38.622279],[-121.370948,38.622359],[-121.370942,38.622631],[-121.370929,38.623179],[-121.370952,38.623305],[-121.370952,38.623442],[-121.37095100000001,38.62375],[-121.370946,38.624522],[-121.370938,38.624644],[-121.370929,38.624687],[-121.37090999999999,38.624727],[-121.370881,38.624764],[-121.370857,38.624786],[-121.37083199999999,38.624802],[-121.370795,38.62477],[-121.370755,38.624743],[-121.37070799999999,38.624721],[-121.37066,38.624706],[-121.37060700000001,38.624696],[-121.37033099999999,38.624683],[-121.37004399999999,38.624684],[-121.369928,38.624691],[-121.36980699999999,38.62471],[-121.369753,38.624714],[-121.369412,38.624713],[-121.369091,38.624703],[-121.36908699999999,38.625416],[-121.369259,38.626096],[-121.369152,38.626548],[-121.368983,38.626393],[-121.36888500000001,38.626104],[-121.368759,38.625733],[-121.368583,38.625614],[-121.368318,38.625619],[-121.36809599999999,38.625743],[-121.368033,38.625854],[-121.367881,38.626054],[-121.36774699999999,38.626165],[-121.367503,38.626219],[-121.36729200000001,38.626155],[-121.367116,38.626043],[-121.367091,38.625883],[-121.36705600000001,38.6258],[-121.36703,38.625737],[-121.366846,38.62557],[-121.366643,38.62543],[-121.36645799999999,38.62545],[-121.366236,38.62549],[-121.36619899999999,38.625485],[-121.365989,38.625454],[-121.365848,38.625405],[-121.365742,38.625321],[-121.365646,38.625223],[-121.365571,38.625137],[-121.365471,38.625021],[-121.36540100000001,38.624917],[-121.365324,38.62483],[-121.365252,38.624749],[-121.365005,38.624672],[-121.364802,38.62467],[-121.36448,38.62475],[-121.36447699999999,38.626554],[-121.36447699999999,38.626907],[-121.364475,38.628502],[-121.364473,38.629913],[-121.364474,38.630666],[-121.362821,38.630654],[-121.36268800000001,38.630664],[-121.362368,38.630713],[-121.362213,38.630726],[-121.361874,38.630732],[-121.361594,38.630728],[-121.361587,38.632084],[-121.362075,38.632091],[-121.362083,38.632398],[-121.362072,38.63263],[-121.36205,38.632792],[-121.36201199999999,38.632883],[-121.36198400000001,38.632926],[-121.361913,38.633004],[-121.361869,38.633038],[-121.36182100000001,38.633068],[-121.36177000000001,38.633094],[-121.361716,38.633116],[-121.361598,38.633146],[-121.36147699999999,38.633156],[-121.36106599999999,38.63314],[-121.360832,38.633123],[-121.36068899999999,38.633104],[-121.360545,38.633077],[-121.360178,38.632982],[-121.360095,38.63314],[-121.360034,38.633305],[-121.359994,38.633474],[-121.359979,38.633587],[-121.359967,38.633878],[-121.360552,38.633905],[-121.361507,38.633949],[-121.361476,38.635886],[-121.360315,38.635876],[-121.360313,38.636296],[-121.360309,38.636342],[-121.360297,38.636385],[-121.360252,38.636492],[-121.360223,38.636597],[-121.36021599999999,38.636649],[-121.360208,38.636705],[-121.360214,38.637036],[-121.360196,38.637425],[-121.360191,38.63765],[-121.36019899999999,38.637693],[-121.36025100000001,38.637819],[-121.360271,38.637901],[-121.360274,38.637942],[-121.360259,38.638393],[-121.359787,38.638385],[-121.35945100000001,38.63837],[-121.359122,38.63835],[-121.358538,38.638298],[-121.357637,38.638212],[-121.35745300000001,38.638201],[-121.357257,38.638212],[-121.357131,38.638232],[-121.357006,38.638263],[-121.356887,38.638303],[-121.356773,38.638354],[-121.356667,38.638413],[-121.35657,38.638481],[-121.356482,38.638556],[-121.356404,38.638638],[-121.356252,38.63883],[-121.356066,38.639045],[-121.355935,38.639183],[-121.355727,38.639385],[-121.355514,38.639569],[-121.355332,38.639472],[-121.355198,38.639413],[-121.355238,38.635611],[-121.354849,38.635607],[-121.35453200000001,38.635605],[-121.353025,38.63557],[-121.353024,38.635391],[-121.353024,38.63422],[-121.353005,38.634168],[-121.35298,38.634137],[-121.352929,38.634102],[-121.352672,38.634047],[-121.352478,38.633993],[-121.35229,38.633929],[-121.352108,38.633854],[-121.35197599999999,38.633791],[-121.35187999999999,38.633889],[-121.35163900000001,38.634095],[-121.351388,38.634287],[-121.35122800000001,38.634161],[-121.351108,38.634082],[-121.350978,38.634013],[-121.35084000000001,38.633956],[-121.350706,38.633912],[-121.350869,38.633604],[-121.35097500000001,38.633363],[-121.35106500000001,38.633118],[-121.351106,38.632982],[-121.351139,38.63287],[-121.351195,38.632619],[-121.35123400000001,38.632367],[-121.351258,38.632113],[-121.351263,38.631931],[-121.34885800000001,38.631895],[-121.348874,38.63128],[-121.348873,38.631165],[-121.348866,38.629336],[-121.349975,38.629339],[-121.34997199999999,38.628976],[-121.351046,38.629731],[-121.351342,38.629727],[-121.3514,38.62972],[-121.35163,38.629665],[-121.35174499999999,38.629648],[-121.35178399999999,38.629642],[-121.35194,38.629632],[-121.352096,38.629635],[-121.352251,38.62965],[-121.35246600000001,38.629688],[-121.352508,38.629581],[-121.35252199999999,38.62949],[-121.35252300000001,38.629398],[-121.352507,38.629306],[-121.35243800000001,38.62913],[-121.352413,38.629035],[-121.352401,38.62894],[-121.35240400000001,38.628448],[-121.352428,38.628333],[-121.35119899999999,38.628314],[-121.34996700000001,38.628294],[-121.346728,38.628244],[-121.345984,38.628233],[-121.34541900000001,38.628224],[-121.344621,38.628212],[-121.343839,38.6282],[-121.34368600000001,38.628198],[-121.342629,38.628182],[-121.337867,38.628109],[-121.33677900000001,38.628096],[-121.336778,38.627239],[-121.336778,38.62683],[-121.337333,38.626832],[-121.337447,38.626827],[-121.337687,38.626783],[-121.337822,38.626769],[-121.339082,38.626784],[-121.34002099999999,38.626346],[-121.340018,38.625739],[-121.340011,38.624526],[-121.339159,38.624516],[-121.339156,38.623744],[-121.339564,38.623743],[-121.33962,38.623746],[-121.33967,38.623756],[-121.33975100000001,38.623786],[-121.340307,38.623178],[-121.34096099999999,38.623445],[-121.340935,38.623486],[-121.340915,38.623529],[-121.340901,38.623574],[-121.34089299999999,38.623619],[-121.340892,38.624536],[-121.34139,38.624542],[-121.341971,38.624549],[-121.34197899999999,38.622939],[-121.34198600000001,38.62256],[-121.342017,38.622425],[-121.342015,38.621777],[-121.342012,38.621501],[-121.341994,38.621401],[-121.341977,38.621352],[-121.341927,38.621258],[-121.341894,38.621167],[-121.341886,38.62112],[-121.341891,38.620943],[-121.342451,38.620949],[-121.343126,38.620958],[-121.343108,38.623735],[-121.343754,38.62373],[-121.34381,38.623723],[-121.344005,38.623677],[-121.344089,38.623672],[-121.344139,38.623661],[-121.344182,38.623637],[-121.344196,38.623622],[-121.344217,38.623585],[-121.344222,38.622337],[-121.34512599999999,38.622342],[-121.34518199999999,38.622347],[-121.34528899999999,38.622372],[-121.34534499999999,38.62238],[-121.34568400000001,38.622377],[-121.346001,38.622394],[-121.346003,38.621751],[-121.34600500000001,38.620994],[-121.347335,38.62101],[-121.3473,38.620044],[-121.34730399999999,38.619593],[-121.34880699999999,38.619612],[-121.34880200000001,38.618292],[-121.350641,38.61831],[-121.350639,38.617416],[-121.35063700000001,38.615314],[-121.350635,38.614571],[-121.350633,38.613784],[-121.351974,38.613801],[-121.353382,38.613818],[-121.353358,38.61517],[-121.35426099999999,38.615173],[-121.35435099999999,38.615166],[-121.354409,38.615162],[-121.354557,38.615138],[-121.354758,38.615093],[-121.354927,38.615068],[-121.35504,38.615059],[-121.355231,38.615056],[-121.35521199999999,38.617395],[-121.355265,38.61747],[-121.35171,38.617429],[-121.351685,38.618378],[-121.351704,38.618849],[-121.352446,38.618807],[-121.352661,38.618799],[-121.35526400000001,38.618822],[-121.35526299999999,38.619873],[-121.357585,38.619869],[-121.35771800000001,38.619879],[-121.357849,38.619904],[-121.357973,38.619942],[-121.35813899999999,38.620014],[-121.35743600000001,38.620685],[-121.357371,38.620757],[-121.357316,38.620834],[-121.357271,38.620916],[-121.357237,38.621],[-121.357208,38.621131],[-121.359863,38.621164],[-121.359859,38.622137],[-121.35985599999999,38.623075],[-121.359855,38.623592],[-121.35985100000001,38.623634],[-121.35984000000001,38.623677],[-121.359821,38.623719],[-121.35979399999999,38.623758],[-121.35971600000001,38.623843],[-121.359762,38.623865],[-121.35987799999999,38.623907],[-121.360006,38.623938],[-121.360135,38.623954],[-121.360268,38.623956],[-121.360398,38.623944],[-121.36076199999999,38.623908],[-121.360992,38.623899],[-121.361223,38.623898],[-121.361366,38.623905],[-121.361429,38.623914],[-121.361548,38.623944],[-121.361605,38.623965],[-121.361712,38.624019],[-121.36180400000001,38.624086],[-121.36184,38.62412],[-121.36191700000001,38.624172],[-121.361966,38.624193],[-121.36201800000001,38.62421],[-121.36207400000001,38.62422],[-121.36212999999999,38.624225],[-121.36224,38.624217],[-121.36229299999999,38.624217],[-121.362343,38.624228],[-121.362443,38.624272],[-121.362549,38.624308],[-121.362661,38.624333],[-121.362776,38.624345],[-121.36435299999999,38.62436],[-121.364481,38.624344],[-121.364476,38.623487],[-121.364468,38.623431],[-121.364463,38.623376],[-121.36446599999999,38.622653],[-121.364476,38.62122],[-121.36634599999999,38.621243],[-121.366359,38.620392],[-121.36721,38.620399],[-121.36726,38.620393],[-121.367313,38.62038],[-121.36736399999999,38.620362],[-121.36741000000001,38.620339],[-121.36748900000001,38.620284],[-121.367603,38.62019],[-121.367693,38.620104],[-121.36777600000001,38.620028],[-121.367935,38.619894],[-121.367977,38.619869],[-121.36802299999999,38.619848],[-121.368072,38.619831],[-121.368123,38.619819],[-121.368174,38.619812],[-121.368228,38.61981],[-121.36902600000001,38.619818],[-121.369131,38.619844],[-121.36913699999999,38.618998]]],"type":"Polygon"}
}`

	str_alt := `{
  "id": 85885597,
  "type": "Feature",
  "properties": {"wof:repo":"whosonfirst-data-admin-us",
    "src:geom":"quattroshapes_pg",
    "wof:geomhash":"fb1dae04ae7723ab1279a131242cf2fc",
    "wof:id":85885597
},
  "bbox": [
    -121.355232,
    38.625453,
    -121.355232,
    38.625453
],
  "geometry": {"coordinates":[-121.355232,38.625453],"type":"Point"}
}`

	primary_r := strings.NewReader(str_primary)
	
	primary_f, err := feature.LoadGeoJSONFeatureFromReader(primary_r)

	if err != nil {
		t.Error(err)
	}

	if whosonfirst.IsAlt(primary_f){
		t.Error(errors.New("Primary feature incorrectly identified as alt file"))
	}

	alt_r := strings.NewReader(str_alt)

	alt_f, err := feature.LoadGeoJSONFeatureFromReader(alt_r)

	if err != nil {
		t.Error(err)
	}

	if !whosonfirst.IsAlt(alt_f){
		t.Error(errors.New("Alt feature not identified as such"))
	}
}
